!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lodash")):"function"==typeof define&&define.amd?define(["exports","lodash"],e):e(t.reduxrestfetcher={},t.lodash)}(this,function(t,e){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)Object.prototype.hasOwnProperty.call(r,o)&&(t[o]=r[o])}return t},n="Error with params. You shoud pass object as params.",i="Error, your object, in params... There is something wrong with it.",s=function deepMerge(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];var n={};return e.forEach(function(t){t.constructor===Object&&(n=function mergeTwo(t,e){var o=e,n={};return Object.keys(t).forEach(function(i){"object"===r(t[i])&&t[i].constructor!==Array?e[i]&&"object"===r(e[i])?n[i]=mergeTwo(t[i],e[i]):n[i]=t[i]:t[i].constructor===Array?(n[i]=t[i],e[i]&&e[i].constructor===Array&&(n[i]=t[i].concat(e[i]))):e[i]?n[i]=e[i]:n[i]=t[i],delete o[i]}),n=Object.assign({},n,o)}(n,t))}),n},a=function _initialiseProps(){var t=this;this.constructUrl=function(r,o){var n=r,i=["body","GET"];return-1===r.indexOf("http")&&(n=""+t.baseUrl+r),e.isObject(o)&&Object.keys(o).forEach(function(e){if(-1===i.indexOf(e)){var r=new RegExp(":"+e);r.test(n)&&(n=n.replace(r,o[e]))}else"GET"===e&&(n+=t.getGetParamsAsString(o[e]))}),n},this.getGetParamsAsString=function(t){var e="?";return Object.keys(t).forEach(function(o,n){"object"!==r(t[o])&&"function"!=typeof t[o]&&(e=e+(0!==n?"&":"")+o+"="+t[o])}),e},this.getBody=function(t){return!!t.body&&("string"==typeof t.body&&e.isObject(JSON.parse(t.body))?{body:t.body}:!!e.isObject(t.body)&&{body:JSON.stringify(t.body)})},this.processParams=function(t){if(!e.isObject(t))throw n;var o={};return Object.keys(t).forEach(function(n){switch(r(t[n])){case"object":o[n]=JSON.stringify(t[n]);break;case"string":if(!e.isObject(JSON.parse(t[n])))throw i;o[n]=t[n]}}),o},this.baseFetch=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=t.constructUrl(e,o),u=void 0;try{u=t.processParams(n)}catch(t){return console.log(t.message),t}var d=s(t.baseOptions,r,u,t.getBody(o));if(a&&(d={headers:{}}),!t.dispatch||null===t.dispatch)return console.log("no dispatch"),t.fetch(c,d);t.dispatch(t.actionStart(i,c,d));var f=void 0;return t.fetch(c,d).then(function(t){if(f={ok:t.ok,redirected:t.redirected,status:t.status,type:t.type,url:t.url},200===t.status||t.ok)return Promise.all([t.json(),Promise.resolve(f)]);throw t}).then(function(e){t.dispatch(t.actionEnd(i,e[0],e[1]))}).catch(function(e){t.dispatch(t.actionError(i,f,e.message))}),!0},this.setEndpoints=function(r){Object.keys(r).forEach(function(o){var n=r[o],i=n.url,s=n.prefetch,a=n.reducer,c=n.options,u=n.useEmptyHeaders;t.reducerPool[o]=a||t.constructGenericReducer(o),t[o]=function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s&&e.isFunction(s)?t.resolvePrefetch(s,i,r,n):t.baseFetch(i,c,r,n,o,u)}})},this.reducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.genererateInitialState(),r=arguments[1];if(-1===r.type.indexOf(t.basePrefix))return e;var o=r.type.substring(t.basePrefix.length);return-1!==o.indexOf("_success")&&(o=o.replace("_success","")),-1!==o.indexOf("_fail")&&(o=o.replace("_fail","")),t.reducerPool[o](e,r)},this.constructGenericReducer=function(t){return function(e,r){var n=o({},e);return n.isLoading=r.loading,-1!==r.type.indexOf("_success")?(n[t].data=r.payload.data,n[t].ok=r.payload.msg.ok,n[t].redirected=r.payload.msg.redirected,n[t].status=r.payload.msg.status,n[t].type=r.payload.msg.type):-1!==r.type.indexOf("_fail")?(n[t].ok=r.payload.msg.ok,n[t].redirected=r.payload.msg.redirected,n[t].status=r.payload.msg.status,n[t].type=r.payload.msg.type,n[t].error=r.payload.error):(n[t].request=r.payload.request,n[t].params=r.payload.params),n}},this.genererateInitialState=function(){var e={isLoading:!1};return Object.keys(t.reducerPool).forEach(function(t){e[t]={request:"",params:"{}",data:void 0,ok:void 0,redirected:void 0,status:0,type:""}}),e},this.actionStart=function(e,r,o){return{type:""+t.basePrefix+e,loading:!0,payload:{request:r,params:o}}},this.actionEnd=function(e,r){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:""+t.basePrefix+e+"_success",loading:!1,payload:{data:r,msg:o}}},this.actionError=function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2];return{type:""+t.basePrefix+e+"_fail",loading:!1,payload:{msg:r,error:o}}},this.getReducer=function(){return t.reducer},this.setBaseUrl=function(e){t.baseUrl=e},this.setDispatcher=function(e){t.dispatch=e},this.setPrefix=function(e){t.basePrefix=e},this.setFetch=function(e){t.fetch=e.bind(window)},this.setBaseOptions=function(e){t.baseOptions=e}},c=new function Communicator(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"localhost:3000",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Communicator),a.call(this),this.baseUrl=t,this.dispatch=e,this.fetch=fetch.bind(window),this.reducerPool={},this.basePrefix="api(.)(.)",this.baseOptions={credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Cache:"no-cache",credentials:"same-origin"}}};t.default=c,Object.defineProperty(t,"__esModule",{value:!0})});