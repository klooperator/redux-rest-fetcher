!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lodash")):"function"==typeof define&&define.amd?define(["exports","lodash"],t):t(e.reduxrestfetcher={},e.lodash)}(this,function(e,t){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=["body","GET","expected"],i=[200,201,202,204,205],n="Error with params. You shoud pass object as params.",s="Error, your object, in params... There is something wrong with it.",a=function deepMerge(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];var i={};return t.forEach(function(e){e.constructor===Object&&(i=function mergeTwo(e,t){var r=t,i={};return Object.keys(e).forEach(function(n){"object"===o(e[n])&&e[n].constructor!==Array?t[n]&&"object"===o(t[n])?i[n]=mergeTwo(e[n],t[n]):i[n]=e[n]:e[n].constructor===Array?(i[n]=e[n],t[n]&&t[n].constructor===Array&&(i[n]=e[n].concat(t[n]))):t[n]?i[n]=t[n]:i[n]=e[n],delete r[n]}),i=Object.assign({},i,r)}(i,e))}),i},c=function _initialiseProps(){var e=this;this.constructUrl=function(o,i){var n=o;return-1===o.indexOf("http")&&(n=""+e.baseUrl+o),t.isObject(i)&&Object.keys(i).forEach(function(t){if(-1===r.indexOf(t)){var o=new RegExp(":"+t);o.test(n)&&(n=n.replace(o,i[t]))}else"GET"===t&&(n+=e.getGetParamsAsString(i[t]))}),n},this.getGetParamsAsString=function(e){var t="?";return Object.keys(e).forEach(function(r,i){"object"!==o(e[r])&&"function"!=typeof e[r]&&(t=t+(0!==i?"&":"")+r+"="+e[r])}),t},this.getBody=function(e){return!!e.body&&("string"==typeof e.body&&t.isObject(JSON.parse(e.body))?{body:e.body}:!!t.isObject(e.body)&&{body:JSON.stringify(e.body)})},this.processParams=function(e){if(!t.isObject(e))throw n;var r={};return Object.keys(e).forEach(function(i){switch(o(e[i])){case"object":r[i]=JSON.stringify(e[i]);break;case"string":if(!t.isObject(JSON.parse(e[i])))throw s;r[i]=e[i]}}),r},this.baseFetch=function(o){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments[4],d=arguments.length>5&&void 0!==arguments[5]&&arguments[5],u=n.expected||"json",f=e.constructUrl(o,n),l=a(e.baseOptions,r,s,e.getBody(n));if(d&&(l={headers:{}}),console.log(n,l),e.prefetchPool[c]&&e.getState){var h=t.isArray(e.prefetchPool[c])?e.prefetchPool[c]:[e.prefetchPool[c]],p={getState:e.getState,dispatch:e.dispatch,request:n,options:l};h.forEach(function(e){console.log(p),console.log(e);var t=e(p);t&&(p=a(p,t))}),p.request&&(f=e.constructUrl(p.request.url||o,p.request)),p.options&&(l=a(p.options,e.getBody(p.request||n)))}else l=a(l,e.getBody(n));if(!e.dispatch||null===e.dispatch)return e.fetch(f,l);e.dispatch(e.actionStart(c,f,l));var g=void 0;return e.fetch(f,l).then(function(e){if(g={ok:e.ok,redirected:e.redirected,status:e.status,type:e.type,url:e.url},-1!==i.indexOf(e.status)||e.ok)return Promise.all([e[u](),Promise.resolve(g)]);throw e}).then(function(t){e.dispatch(e.actionEnd(c,t[0],t[1]))}).catch(function(t){e.dispatch(e.actionError(c,g,t.message))}),!0},this.setEndpoints=function(o){Object.keys(o).forEach(function(r){var i=o[r],n=i.url,s=i.prefetch,a=i.reducer,c=i.options,d=i.useEmptyHeaders;e.reducerPool[r]=a||e.constructGenericReducer(r),s&&t.isFunction(s)&&(e.prefetchPool[r]=s),e[r]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2];return e.baseFetch(n,c,t,o,r,i||d)}})},this.reducer=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.genererateInitialState(),o=arguments[1];if(-1===o.type.indexOf(e.basePrefix))return t;var r=o.type.substring(e.basePrefix.length);return-1!==r.indexOf("_success")&&(r=r.replace("_success","")),-1!==r.indexOf("_fail")&&(r=r.replace("_fail","")),e.reducerPool[r](t,o)},this.constructGenericReducer=function(e){return function(t,o){var r=Object.assign({},t);return r[e]=Object.assign({},t[e]),o.loading?r.isLoading&&r.isLoading.length?r.isLoading.push(e):(r.isLoading=[],r.isLoading.push(e)):(r.isLoading&&r.isLoading.length&&-1!==r.isLoading.indexOf(e)&&r.isLoading.splice(r.isLoading.indexOf(e),1),r.isLoading&&0===r.isLoading.length&&(r.isLoading=!1)),-1!==o.type.indexOf("_success")?(r[e].loading=!1,r[e].data=o.payload.data,r[e].ok=o.payload.msg.ok,r[e].redirected=o.payload.msg.redirected,r[e].status=o.payload.msg.status,r[e].type=o.payload.msg.type):-1!==o.type.indexOf("_fail")?(r[e].loading=!1,r[e].ok=o.payload.msg.ok,r[e].redirected=o.payload.msg.redirected,r[e].status=o.payload.msg.status,r[e].type=o.payload.msg.type,r[e].error=o.payload.error):(r[e].loading=!0,r[e].request=o.payload.request,r[e].params=o.payload.params),r}},this.genererateInitialState=function(){var t={isLoading:!1};return Object.keys(e.reducerPool).forEach(function(e){t[e]={request:"",params:"{}",data:void 0,ok:void 0,redirected:void 0,status:0,type:""}}),t},this.actionStart=function(t,o,r){return{type:""+e.basePrefix+t,loading:!0,payload:{request:o,params:r}}},this.actionEnd=function(t,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:""+e.basePrefix+t+"_success",loading:!1,payload:{data:o,msg:r}}},this.actionError=function(t){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];return{type:""+e.basePrefix+t+"_fail",loading:!1,payload:{msg:o,error:r}}},this.getReducer=function(){return e.reducer},this.setBaseUrl=function(t){e.baseUrl=t},this.setDispatcher=function(t){e.dispatch=t},this.setPrefix=function(t){e.basePrefix=t},this.setFetch=function(t){e.fetch=t.bind(window)},this.setBaseOptions=function(t){e.baseOptions=t},this.setGetState=function(t){e.getState=t}},d=new function Communicator(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Communicator),c.call(this),this.baseUrl=e,this.dispatch=t,this.fetch=fetch.bind(window),this.reducerPool={},this.prefetchPool={},this.getState=void 0,this.basePrefix="api(.)(.)",this.baseOptions={credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Cache:"no-cache",credentials:"same-origin"}}};e.default=d,Object.defineProperty(e,"__esModule",{value:!0})});