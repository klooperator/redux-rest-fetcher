!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lodash")):"function"==typeof define&&define.amd?define(["exports","lodash"],e):e(t.reduxrestfetcher={},t.lodash)}(this,function(t,l){var h={object:function object(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return l.isObject(t)?t:l.toPlainObject(t)},array:function array(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return l.isArray?t:l.toArray(t)}},n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=["body","GET","expected"],p=[200,201,202,204,205],r="Error with params. You shoud pass object as params.",s="Error, your object, in params... There is something wrong with it.",y=function deepMerge(){for(var t=arguments.length,e=Array(t),o=0;o<t;o++)e[o]=arguments[o];var r={};return e.forEach(function(t){t.constructor===Object&&(r=function mergeTwo(e,o){var r=o,i={};return Object.keys(e).forEach(function(t){"object"===n(e[t])&&e[t].constructor!==Array?o[t]&&"object"===n(o[t])?i[t]=mergeTwo(e[t],o[t]):i[t]=e[t]:e[t].constructor===Array?(i[t]=e[t],o[t]&&o[t].constructor===Array&&(i[t]=e[t].concat(o[t]))):o[t]?i[t]=o[t]:i[t]=e[t],delete r[t]}),i=Object.assign({},i,r)}(r,t))}),console.log(JSON.parse(JSON.stringify(r))),r},o=function _initialiseProps(){var f=this;this.constructUrl=function(t,o){var r=t;return-1===t.indexOf("http")&&(r=""+f.baseUrl+t),l.isObject(o)&&Object.keys(o).forEach(function(t){if(-1===i.indexOf(t)){var e=new RegExp(":"+t);e.test(r)&&(r=r.replace(e,o[t]))}else"GET"===t&&(r+=f.getGetParamsAsString(o[t]))}),r},this.getGetParamsAsString=function(o){var r="?";return Object.keys(o).forEach(function(t,e){"object"!==n(o[t])&&"function"!=typeof o[t]&&(r=r+(0!==e?"&":"")+t+"="+o[t])}),r},this.getBody=function(t){return!!t.body&&("string"==typeof t.body&&l.isObject(JSON.parse(t.body))?{body:t.body}:!!l.isObject(t.body)&&{body:JSON.stringify(t.body)})},this.processParams=function(e){if(!l.isObject(e))throw r;var o={};return Object.keys(e).forEach(function(t){switch(n(e[t])){case"object":o[t]=JSON.stringify(e[t]);break;case"string":if(!l.isObject(JSON.parse(e[t])))throw s;o[t]=e[t]}}),o},this.baseFetch=function(t){var e,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},n=arguments[4],s=5<arguments.length&&void 0!==arguments[5]&&arguments[5],a=r.expected||"json",c=y(f.baseOptions,o,i);s&&(c={headers:{}});var d={actions:f.actions,getState:f.getState,dispatch:f.dispatch,params:r,options:c,url:t};f.prefetchPool[n]&&f.getState&&(l.isArray(f.prefetchPool[n])?f.prefetchPool[n]:[f.prefetchPool[n]]).forEach(function(t){var e=t(d);e&&(d=y(d,e))});if(c=y(d.options,f.getBody(d.params)),e=f.constructUrl(d.url,d.params),!f.dispatch||null===f.dispatch)return f.fetch(e,c);f.dispatch(f.actionStart(n,e,c));var u=void 0;return f.fetch(e,c).then(function(t){if(u={ok:t.ok,redirected:t.redirected,status:t.status,type:t.type,url:t.url},-1!==p.indexOf(t.status)||t.ok)return Promise.all([t[a](),Promise.resolve(u)]);throw t}).then(function(t){f.dispatch(f.actionEnd(n,t[0],t[1]))}).catch(function(t){f.dispatch(f.actionError(n,u,t.message))}),!0},this.setEndpoints=function(u){Object.keys(u).forEach(function(r){var t=u[r],i=t.url,e=t.prefetch,o=t.reducer,n=t.options,s=t.useEmptyHeaders,a=t.postfetch,c=t.transformer,d=void 0===c?h.object:c;f.reducerPool[r]=o||f.constructGenericReducer(r),e&&(l.isFunction(e)||l.isArray(e))&&(f.prefetchPool[r]=e),a&&(l.isFunction(a)||l.isArray(a))&&(f.postfetchPool[r]=a),d&&l.isFunction(d)&&(f.transformerPool[r]=d),f[r]=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2];return f.baseFetch(i,n,t,e,r,o||s)},f.actions[r]=f[r]})},this.reducer=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:f.genererateInitialState(),e=arguments[1];if(-1===e.type.indexOf(f.basePrefix))return t;var o=e.type.substring(f.basePrefix.length);return-1!==o.indexOf("_success")&&(o=o.replace("_success","")),-1!==o.indexOf("_fail")&&(o=o.replace("_fail","")),f.reducerPool[o](t,e)},this.constructGenericReducer=function(r){return function(t,e){var o=Object.assign({},t);return o[r]=Object.assign({},t[r]),e.loading?(o.isLoading&&o.isLoading.length||(o.isLoading=[]),o.isLoading.push(r)):(o.isLoading&&o.isLoading.length&&-1!==o.isLoading.indexOf(r)&&o.isLoading.splice(o.isLoading.indexOf(r),1),o.isLoading&&0===o.isLoading.length&&(o.isLoading=!1)),-1!==e.type.indexOf("_success")?(o[r].loading=!1,o[r].data=e.payload.data,o[r].ok=e.payload.msg.ok,o[r].redirected=e.payload.msg.redirected,o[r].status=e.payload.msg.status,o[r].type=e.payload.msg.type):-1!==e.type.indexOf("_fail")?(o[r].loading=!1,o[r].ok=e.payload.msg.ok,o[r].redirected=e.payload.msg.redirected,o[r].status=e.payload.msg.status,o[r].type=e.payload.msg.type,o[r].error=e.payload.error):(o[r].loading=!0,o[r].request=e.payload.request,o[r].params=e.payload.params),o}},this.genererateInitialState=function(){var e={isLoading:!1};return Object.keys(f.reducerPool).forEach(function(t){e[t]={request:"",params:"{}",data:f.transformerPool[t],ok:void 0,redirected:void 0,status:0,type:""}}),e},this.actionStart=function(t,e,o){return{type:""+f.basePrefix+t,loading:!0,payload:{request:e,params:o}}},this.actionEnd=function(t,e){var o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};return{type:""+f.basePrefix+t+"_success",loading:!1,payload:{data:e,msg:o}}},this.actionError=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},o=arguments[2];return{type:""+f.basePrefix+t+"_fail",loading:!1,payload:{msg:e,error:o}}},this.getReducer=function(){return f.reducer},this.setBaseUrl=function(t){f.baseUrl=t},this.setDispatcher=function(t){f.dispatch=t},this.setPrefix=function(t){f.basePrefix=t},this.setFetch=function(t){f.fetch=t.bind(window)},this.setBaseOptions=function(t){f.baseOptions=t},this.setGetState=function(t){f.getState=t}},e=new function Communicator(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Communicator),o.call(this),this.baseUrl=t,this.dispatch=e,this.fetch=fetch.bind(window),this.reducerPool={},this.prefetchPool={},this.postfetchPool={},this.transformerPool={},this.actions={},this.getState=void 0,this.basePrefix="api(.)(.)",this.baseOptions={credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Cache:"no-cache",credentials:"same-origin"}}};t.default=e,Object.defineProperty(t,"__esModule",{value:!0})});