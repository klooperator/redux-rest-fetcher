!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lodash")):"function"==typeof define&&define.amd?define(["exports","lodash"],e):e(t.reduxrestfetcher={},t.lodash)}(this,function(t,e){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var o=arguments[e];for(var r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r])}return t},i=["body","GET","expected"],n=[200,201,202,204,205],s="Error with params. You shoud pass object as params.",a="Error, your object, in params... There is something wrong with it.",c=function deepMerge(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];var i={};return e.forEach(function(t){t.constructor===Object&&(i=function mergeTwo(t,e){var r=e,i={};return Object.keys(t).forEach(function(n){"object"===o(t[n])&&t[n].constructor!==Array?e[n]&&"object"===o(e[n])?i[n]=mergeTwo(t[n],e[n]):i[n]=t[n]:t[n].constructor===Array?(i[n]=t[n],e[n]&&e[n].constructor===Array&&(i[n]=t[n].concat(e[n]))):e[n]?i[n]=e[n]:i[n]=t[n],delete r[n]}),i=Object.assign({},i,r)}(i,t))}),i},d=function _initialiseProps(){var t=this;this.constructUrl=function(o,r){var n=o;return-1===o.indexOf("http")&&(n=""+t.baseUrl+o),e.isObject(r)&&Object.keys(r).forEach(function(e){if(-1===i.indexOf(e)){var o=new RegExp(":"+e);o.test(n)&&(n=n.replace(o,r[e]))}else"GET"===e&&(n+=t.getGetParamsAsString(r[e]))}),n},this.getGetParamsAsString=function(t){var e="?";return Object.keys(t).forEach(function(r,i){"object"!==o(t[r])&&"function"!=typeof t[r]&&(e=e+(0!==i?"&":"")+r+"="+t[r])}),e},this.getBody=function(t){return!!t.body&&("string"==typeof t.body&&e.isObject(JSON.parse(t.body))?{body:t.body}:!!e.isObject(t.body)&&{body:JSON.stringify(t.body)})},this.processParams=function(t){if(!e.isObject(t))throw s;var r={};return Object.keys(t).forEach(function(i){switch(o(t[i])){case"object":r[i]=JSON.stringify(t[i]);break;case"string":if(!e.isObject(JSON.parse(t[i])))throw a;r[i]=t[i]}}),r},this.baseFetch=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=arguments[4],a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],d=r.expected||"json",u=t.constructUrl(e,r),f=void 0;try{f=t.processParams(i)}catch(t){return console.log(t.message),t}var l=c(t.baseOptions,o,f,t.getBody(r));if(a&&(l={headers:{}}),!t.dispatch||null===t.dispatch)return console.log("no dispatch"),t.fetch(u,l);if(t.prefetchPool[s]&&t.getState){var h=t.prefetchPool[s](t.getState())(u,l);h.url&&(u=h.url),h.options&&(l=h.options)}t.dispatch(t.actionStart(s,u,l));var p=void 0;return t.fetch(u,l).then(function(t){if(p={ok:t.ok,redirected:t.redirected,status:t.status,type:t.type,url:t.url},-1!==n.indexOf(t.status)||t.ok)return Promise.all([t[d](),Promise.resolve(p)]);throw t}).then(function(e){t.dispatch(t.actionEnd(s,e[0],e[1]))}).catch(function(e){t.dispatch(t.actionError(s,p,e.message))}),!0},this.setEndpoints=function(o){Object.keys(o).forEach(function(r){var i=o[r],n=i.url,s=i.prefetch,a=i.reducer,c=i.options,d=i.useEmptyHeaders;t.reducerPool[r]=a||t.constructGenericReducer(r),s&&e.isFunction(s)&&(t.prefetchPool[r]=s),t[r]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return t.baseFetch(n,c,e,o,r,d)}})},this.reducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.genererateInitialState(),o=arguments[1];if(-1===o.type.indexOf(t.basePrefix))return e;var r=o.type.substring(t.basePrefix.length);return-1!==r.indexOf("_success")&&(r=r.replace("_success","")),-1!==r.indexOf("_fail")&&(r=r.replace("_fail","")),t.reducerPool[r](e,o)},this.constructGenericReducer=function(t){return function(e,o){var i=r({},e);return o.loading?i.isLoading&&i.isLoading.length?i.isLoading.push(t):(i.isLoading=[],i.isLoading.push(t)):(i.isLoading&&i.isLoading.length&&-1!==i.isLoading.indexOf(t)&&i.isLoading.splice(i.isLoading.indexOf(t),1),i.isLoading&&0===i.isLoading.length&&(i.isLoading=!1)),-1!==o.type.indexOf("_success")?(i[t].loading=!1,i[t].data=o.payload.data,i[t].ok=o.payload.msg.ok,i[t].redirected=o.payload.msg.redirected,i[t].status=o.payload.msg.status,i[t].type=o.payload.msg.type):-1!==o.type.indexOf("_fail")?(i[t].loading=!1,i[t].ok=o.payload.msg.ok,i[t].redirected=o.payload.msg.redirected,i[t].status=o.payload.msg.status,i[t].type=o.payload.msg.type,i[t].error=o.payload.error):(i[t].loading=!0,i[t].request=o.payload.request,i[t].params=o.payload.params),i}},this.genererateInitialState=function(){var e={isLoading:!1};return Object.keys(t.reducerPool).forEach(function(t){e[t]={request:"",params:"{}",data:void 0,ok:void 0,redirected:void 0,status:0,type:""}}),e},this.actionStart=function(e,o,r){return{type:""+t.basePrefix+e,loading:!0,payload:{request:o,params:r}}},this.actionEnd=function(e,o){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:""+t.basePrefix+e+"_success",loading:!1,payload:{data:o,msg:r}}},this.actionError=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];return{type:""+t.basePrefix+e+"_fail",loading:!1,payload:{msg:o,error:r}}},this.getReducer=function(){return t.reducer},this.setBaseUrl=function(e){t.baseUrl=e},this.setDispatcher=function(e){t.dispatch=e},this.setPrefix=function(e){t.basePrefix=e},this.setFetch=function(e){t.fetch=e.bind(window)},this.setBaseOptions=function(e){t.baseOptions=e},this.setGetState=function(e){t.getState=e}},u=new function Communicator(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Communicator),d.call(this),this.baseUrl=t,this.dispatch=e,this.fetch=fetch.bind(window),this.reducerPool={},this.prefetchPool={},this.getState=void 0,this.basePrefix="api(.)(.)",this.baseOptions={credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Cache:"no-cache",credentials:"same-origin"}}};t.default=u,Object.defineProperty(t,"__esModule",{value:!0})});