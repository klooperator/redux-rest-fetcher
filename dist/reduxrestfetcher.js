!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("lodash")):"function"==typeof define&&define.amd?define(["exports","lodash"],e):e(t.reduxrestfetcher={},t.lodash)}(this,function(t,e){var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=["body","GET","expected"],r=[200,201,202,204,205],n="Error with params. You shoud pass object as params.",s="Error, your object, in params... There is something wrong with it.",a=function deepMerge(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++)e[i]=arguments[i];var r={};return e.forEach(function(t){t.constructor===Object&&(r=function mergeTwo(t,e){var i=e,r={};return Object.keys(t).forEach(function(n){"object"===o(t[n])&&t[n].constructor!==Array?e[n]&&"object"===o(e[n])?r[n]=mergeTwo(t[n],e[n]):r[n]=t[n]:t[n].constructor===Array?(r[n]=t[n],e[n]&&e[n].constructor===Array&&(r[n]=t[n].concat(e[n]))):e[n]?r[n]=e[n]:r[n]=t[n],delete i[n]}),r=Object.assign({},r,i)}(r,t))}),console.log(JSON.parse(JSON.stringify(r))),r},c=function _initialiseProps(){var t=this;this.constructUrl=function(o,r){var n=o;return-1===o.indexOf("http")&&(n=""+t.baseUrl+o),e.isObject(r)&&Object.keys(r).forEach(function(e){if(-1===i.indexOf(e)){var o=new RegExp(":"+e);o.test(n)&&(n=n.replace(o,r[e]))}else"GET"===e&&(n+=t.getGetParamsAsString(r[e]))}),n},this.getGetParamsAsString=function(t){var e="?";return Object.keys(t).forEach(function(i,r){"object"!==o(t[i])&&"function"!=typeof t[i]&&(e=e+(0!==r?"&":"")+i+"="+t[i])}),e},this.getBody=function(t){return!!t.body&&("string"==typeof t.body&&e.isObject(JSON.parse(t.body))?{body:t.body}:!!e.isObject(t.body)&&{body:JSON.stringify(t.body)})},this.processParams=function(t){if(!e.isObject(t))throw n;var i={};return Object.keys(t).forEach(function(r){switch(o(t[r])){case"object":i[r]=JSON.stringify(t[r]);break;case"string":if(!e.isObject(JSON.parse(t[r])))throw s;i[r]=t[r]}}),i},this.baseFetch=function(o){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},d=arguments[4],u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],f=s.expected||"json",p=a(t.baseOptions,n,c);u&&(p={headers:{}});var h={actions:t.actions,getState:t.getState,dispatch:t.dispatch,params:s,options:p,url:o};t.prefetchPool[d]&&t.getState&&(e.isArray(t.prefetchPool[d])?t.prefetchPool[d]:[t.prefetchPool[d]]).forEach(function(t){var e=t(h);e&&(h=a(h,e))});if(p=a(h.options,t.getBody(h.params)),i=t.constructUrl(h.url,h.params),!t.dispatch||null===t.dispatch)return t.fetch(i,p);t.dispatch(t.actionStart(d,i,p));var l=void 0;return t.fetch(i,p).then(function(t){if(l={ok:t.ok,redirected:t.redirected,status:t.status,type:t.type,url:t.url},-1!==r.indexOf(t.status)||t.ok)return Promise.all([t[f](),Promise.resolve(l)]);throw t}).then(function(e){t.dispatch(t.actionEnd(d,e[0],e[1]))}).catch(function(e){t.dispatch(t.actionError(d,l,e.message))}),!0},this.setEndpoints=function(o){Object.keys(o).forEach(function(i){var r=o[i],n=r.url,s=r.prefetch,a=r.reducer,c=r.options,d=r.useEmptyHeaders;t.reducerPool[i]=a||t.constructGenericReducer(i),s&&(e.isFunction(s)||e.isArray(s))&&(t.prefetchPool[i]=s),t[i]=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments[2];return t.baseFetch(n,c,e,o,i,r||d)},t.actions[i]=t[i]})},this.reducer=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.genererateInitialState(),o=arguments[1];if(-1===o.type.indexOf(t.basePrefix))return e;var i=o.type.substring(t.basePrefix.length);return-1!==i.indexOf("_success")&&(i=i.replace("_success","")),-1!==i.indexOf("_fail")&&(i=i.replace("_fail","")),t.reducerPool[i](e,o)},this.constructGenericReducer=function(t){return function(e,o){var i=Object.assign({},e);return i[t]=Object.assign({},e[t]),o.loading?i.isLoading&&i.isLoading.length?i.isLoading.push(t):(i.isLoading=[],i.isLoading.push(t)):(i.isLoading&&i.isLoading.length&&-1!==i.isLoading.indexOf(t)&&i.isLoading.splice(i.isLoading.indexOf(t),1),i.isLoading&&0===i.isLoading.length&&(i.isLoading=!1)),-1!==o.type.indexOf("_success")?(i[t].loading=!1,i[t].data=o.payload.data,i[t].ok=o.payload.msg.ok,i[t].redirected=o.payload.msg.redirected,i[t].status=o.payload.msg.status,i[t].type=o.payload.msg.type):-1!==o.type.indexOf("_fail")?(i[t].loading=!1,i[t].ok=o.payload.msg.ok,i[t].redirected=o.payload.msg.redirected,i[t].status=o.payload.msg.status,i[t].type=o.payload.msg.type,i[t].error=o.payload.error):(i[t].loading=!0,i[t].request=o.payload.request,i[t].params=o.payload.params),i}},this.genererateInitialState=function(){var e={isLoading:!1};return Object.keys(t.reducerPool).forEach(function(t){e[t]={request:"",params:"{}",data:void 0,ok:void 0,redirected:void 0,status:0,type:""}}),e},this.actionStart=function(e,o,i){return{type:""+t.basePrefix+e,loading:!0,payload:{request:o,params:i}}},this.actionEnd=function(e,o){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return{type:""+t.basePrefix+e+"_success",loading:!1,payload:{data:o,msg:i}}},this.actionError=function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments[2];return{type:""+t.basePrefix+e+"_fail",loading:!1,payload:{msg:o,error:i}}},this.getReducer=function(){return t.reducer},this.setBaseUrl=function(e){t.baseUrl=e},this.setDispatcher=function(e){t.dispatch=e},this.setPrefix=function(e){t.basePrefix=e},this.setFetch=function(e){t.fetch=e.bind(window)},this.setBaseOptions=function(e){t.baseOptions=e},this.setGetState=function(e){t.getState=e}},d=new function Communicator(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,Communicator),c.call(this),this.baseUrl=t,this.dispatch=e,this.fetch=fetch.bind(window),this.reducerPool={},this.prefetchPool={},this.actions={},this.getState=void 0,this.basePrefix="api(.)(.)",this.baseOptions={credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json",Cache:"no-cache",credentials:"same-origin"}}};t.default=d,Object.defineProperty(t,"__esModule",{value:!0})});